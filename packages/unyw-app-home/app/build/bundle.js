var app=function(){"use strict";function n(){}function t(n){return n()}function e(){return Object.create(null)}function o(n){n.forEach(t)}function c(n){return"function"==typeof n}function r(n,t){return n!=n?t==t:n!==t||n&&"object"==typeof n||"function"==typeof n}let i,l;function a(n){return null==n?"":n}function s(n,t){n.appendChild(t)}function d(n,t,e){n.insertBefore(t,e||null)}function u(n){n.parentNode.removeChild(n)}function f(n,t){for(let e=0;e<n.length;e+=1)n[e]&&n[e].d(t)}function p(n){return document.createElement(n)}function h(n){return document.createTextNode(n)}function v(){return h(" ")}function m(n,t,e){null==e?n.removeAttribute(t):n.getAttribute(t)!==e&&n.setAttribute(t,e)}function g(n,t,e){n.classList[e?"add":"remove"](t)}function b(n){l=n}function $(){if(!l)throw new Error("Function called outside component initialization");return l}const y=[],k=[],w=[],_=[],x=Promise.resolve();let C=!1;function E(n){w.push(n)}let z=!1;const j=new Set;function L(){if(!z){z=!0;do{for(let n=0;n<y.length;n+=1){const t=y[n];b(t),P(t.$$)}for(b(null),y.length=0;k.length;)k.pop()();for(let n=0;n<w.length;n+=1){const t=w[n];j.has(t)||(j.add(t),t())}w.length=0}while(y.length);for(;_.length;)_.pop()();C=!1,z=!1,j.clear()}}function P(n){if(null!==n.fragment){n.update(),o(n.before_update);const t=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,t),n.after_update.forEach(E)}}const T=new Set;let N;function A(){N={r:0,c:[],p:N}}function O(){N.r||o(N.c),N=N.p}function I(n,t){n&&n.i&&(T.delete(n),n.i(t))}function K(n,t,e,o){if(n&&n.o){if(T.has(n))return;T.add(n),N.c.push((()=>{T.delete(n),o&&(e&&n.d(1),o())})),n.o(t)}}function S(n,t){const e=t.token={};function o(n,o,c,r){if(t.token!==e)return;t.resolved=r;let i=t.ctx;void 0!==c&&(i=i.slice(),i[c]=r);const l=n&&(t.current=n)(i);let a=!1;t.block&&(t.blocks?t.blocks.forEach(((n,e)=>{e!==o&&n&&(A(),K(n,1,1,(()=>{t.blocks[e]===n&&(t.blocks[e]=null)})),O())})):t.block.d(1),l.c(),I(l,1),l.m(t.mount(),t.anchor),a=!0),t.block=l,t.blocks&&(t.blocks[o]=l),a&&L()}if((c=n)&&"object"==typeof c&&"function"==typeof c.then){const e=$();if(n.then((n=>{b(e),o(t.then,1,t.value,n),b(null)}),(n=>{if(b(e),o(t.catch,2,t.error,n),b(null),!t.hasCatch)throw n})),t.current!==t.pending)return o(t.pending,0),!0}else{if(t.current!==t.then)return o(t.then,1,t.value,n),!0;t.resolved=n}var c}function V(n,t,e){const o=t.slice(),{resolved:c}=n;n.current===n.then&&(o[n.value]=c),n.current===n.catch&&(o[n.error]=c),n.block.p(o,e)}function W(n){n&&n.c()}function D(n,e,r,i){const{fragment:l,on_mount:a,on_destroy:s,after_update:d}=n.$$;l&&l.m(e,r),i||E((()=>{const e=a.map(t).filter(c);s?s.push(...e):o(e),n.$$.on_mount=[]})),d.forEach(E)}function H(n,t){const e=n.$$;null!==e.fragment&&(o(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function U(n,t){-1===n.$$.dirty[0]&&(y.push(n),C||(C=!0,x.then(L)),n.$$.dirty.fill(0)),n.$$.dirty[t/31|0]|=1<<t%31}function q(t,c,r,i,a,s,d,f=[-1]){const p=l;b(t);const h=t.$$={fragment:null,ctx:null,props:s,update:n,not_equal:a,bound:e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(p?p.$$.context:c.context||[]),callbacks:e(),dirty:f,skip_bound:!1,root:c.target||p.$$.root};d&&d(h.root);let v=!1;if(h.ctx=r?r(t,c.props||{},((n,e,...o)=>{const c=o.length?o[0]:e;return h.ctx&&a(h.ctx[n],h.ctx[n]=c)&&(!h.skip_bound&&h.bound[n]&&h.bound[n](c),v&&U(t,n)),e})):[],h.update(),v=!0,o(h.before_update),h.fragment=!!i&&i(h.ctx),c.target){if(c.hydrate){const n=function(n){return Array.from(n.childNodes)}(c.target);h.fragment&&h.fragment.l(n),n.forEach(u)}else h.fragment&&h.fragment.c();c.intro&&I(t.$$.fragment),D(t,c.target,c.anchor,c.customElement),L()}b(p)}class M{$destroy(){H(this,1),this.$destroy=n}$on(n,t){const e=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return e.push(t),()=>{const n=e.indexOf(t);-1!==n&&e.splice(n,1)}}$set(n){var t;this.$$set&&(t=n,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}function Y(n,t,e){const o=n.slice();return o[3]=t[e],o}function R(n){let t,e,o,c,r,i,l,f,b,$=n[1][n[3]].label+"";function y(){return n[2](n[3])}return{c(){t=p("div"),e=p("i"),c=v(),r=p("p"),i=h($),l=v(),m(e,"class",o=a(n[1][n[3]].icon)+" svelte-zd2vxj"),m(r,"class","svelte-zd2vxj"),m(t,"class","svelte-zd2vxj"),g(t,"active",n[3]==n[0])},m(n,o){var a,u,p,h;d(n,t,o),s(t,e),s(t,c),s(t,r),s(r,i),s(t,l),f||(u="click",p=y,(a=t).addEventListener(u,p,h),b=()=>a.removeEventListener(u,p,h),f=!0)},p(c,r){n=c,2&r&&o!==(o=a(n[1][n[3]].icon)+" svelte-zd2vxj")&&m(e,"class",o),2&r&&$!==($=n[1][n[3]].label+"")&&function(n,t){t=""+t,n.wholeText!==t&&(n.data=t)}(i,$),3&r&&g(t,"active",n[3]==n[0])},d(n){n&&u(t),f=!1,b()}}}function B(t){let e,o,c=Object.keys(t[1]),r=[];for(let n=0;n<c.length;n+=1)r[n]=R(Y(t,c,n));return{c(){e=p("div"),o=p("div");for(let n=0;n<r.length;n+=1)r[n].c();m(o,"class","container svelte-zd2vxj"),m(e,"class","unywui-bottombar svelte-zd2vxj")},m(n,t){d(n,e,t),s(e,o);for(let n=0;n<r.length;n+=1)r[n].m(o,null)},p(n,[t]){if(3&t){let e;for(c=Object.keys(n[1]),e=0;e<c.length;e+=1){const i=Y(n,c,e);r[e]?r[e].p(i,t):(r[e]=R(i),r[e].c(),r[e].m(o,null))}for(;e<r.length;e+=1)r[e].d(1);r.length=c.length}},i:n,o:n,d(n){n&&u(e),f(r,n)}}}function F(n,t,e){let{tabs:o={}}=t,{active:c=""}=t;return n.$$set=n=>{"tabs"in n&&e(1,o=n.tabs),"active"in n&&e(0,c=n.active)},[c,o,n=>e(0,c=n)]}class J extends M{constructor(n){super(),q(this,n,F,B,r,{tabs:1,active:0})}}const G=window.__UNYW_PRIVATE_IP||"localhost";let Q=null;const X=async(n="",t={})=>(await fetch(n,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)})).json(),Z=async()=>(await fetch("/UNYW_TOKEN_API.json").then((n=>n.json()))).token,nn=n=>new Promise((t=>setTimeout(t,n)));var tn=async()=>{for(;;){try{return null==Q&&(Q=await(async()=>{const n="localhost"!=G?"debugapi":await Z(),t={},e=await X(`http://${G}:12080/unyw/info?token=${n}`);return Object.entries(e.api).forEach((([e,o])=>{t[e]={},o.forEach((o=>{t[e][o]=async t=>X(`http://${G}:12080/${e}/${o}?token=${n}`,t)}))})),t.unyw.info=async()=>e,t})()),Q}catch(n){console.log("error")}await nn(100)}};function en(n){n[5]=n[8].vnc.token,n[6]=n[8].vnc.width,n[7]=n[8].vnc.height}function on(t){let e;return{c(){e=p("p"),e.textContent="Error"},m(n,t){d(n,e,t)},p:n,d(n){n&&u(e)}}}function cn(n){let t,e;return en(n),{c(){t=p("iframe"),m(t,"id","lc-layout-vncviewer"),m(t,"title","vncviewer"),m(t,"srcdoc",e=`\n    <html>\n    <${an} src='./novnc/novnc.min.js'></${an}>\n    <style> \n      body { width:${n[6]}px; height:${n[7]}px; }\n      body * { overflow: hidden !important;  background-color: ${n[0]} !important;}\n      body > canvas { background-color: transparent !important;}\n    </style>\n    <body style='overflow: hidden; padding: 0; margin:0; background-color: ${n[0]};'>\n      <${an}>\n        window.onload = function(){\n          console.log('onload')\n          var vncConnection = new noVNC(\n              document.body,\n              'ws://${n[2]}:12081/websockify',\n              {repeaterID: '',  shared: true,  credentials: { password: '${n[5]}' }, }\n          )\n\n          document.body.addEventListener('keydown',  (e) =>\tvncConnection._keyboard._handleKeyDown(e)  )\n          document.body.addEventListener('keyup',    (e) => vncConnection._keyboard._handleKeyUp(e)    )\n          document.body.addEventListener('keypress', (e) => vncConnection._keyboard._handleKeyPress(e) )\n          vncConnection.scaleViewport = true\n          vncConnection.addEventListener('disconnect', () => setTimeout( () => location.reload(), 500));\n          vncConnection.addEventListener('credentialsrequired', () => vncConnection.sendCredentials({ password: '${n[5]}' }));\n        }\n      </${an}>\n    </html> `),m(t,"class","svelte-zuad0b")},m(n,e){d(n,t,e)},p(n,o){en(n),1&o&&e!==(e=`\n    <html>\n    <${an} src='./novnc/novnc.min.js'></${an}>\n    <style> \n      body { width:${n[6]}px; height:${n[7]}px; }\n      body * { overflow: hidden !important;  background-color: ${n[0]} !important;}\n      body > canvas { background-color: transparent !important;}\n    </style>\n    <body style='overflow: hidden; padding: 0; margin:0; background-color: ${n[0]};'>\n      <${an}>\n        window.onload = function(){\n          console.log('onload')\n          var vncConnection = new noVNC(\n              document.body,\n              'ws://${n[2]}:12081/websockify',\n              {repeaterID: '',  shared: true,  credentials: { password: '${n[5]}' }, }\n          )\n\n          document.body.addEventListener('keydown',  (e) =>\tvncConnection._keyboard._handleKeyDown(e)  )\n          document.body.addEventListener('keyup',    (e) => vncConnection._keyboard._handleKeyUp(e)    )\n          document.body.addEventListener('keypress', (e) => vncConnection._keyboard._handleKeyPress(e) )\n          vncConnection.scaleViewport = true\n          vncConnection.addEventListener('disconnect', () => setTimeout( () => location.reload(), 500));\n          vncConnection.addEventListener('credentialsrequired', () => vncConnection.sendCredentials({ password: '${n[5]}' }));\n        }\n      </${an}>\n    </html> `)&&m(t,"srcdoc",e)},d(n){n&&u(t)}}}function rn(t){return{c:n,m:n,p:n,d:n}}function ln(t){let e,o={ctx:t,current:null,token:null,hasCatch:!0,pending:rn,then:cn,catch:on,value:8,error:9};return S(t[3],o),{c(){e=p("div"),o.block.c(),m(e,"class","svelte-zuad0b")},m(n,c){d(n,e,c),o.block.m(e,o.anchor=null),o.mount=()=>e,o.anchor=null,t[4](e)},p(n,[e]){V(o,t=n,e)},i:n,o:n,d(n){n&&u(e),o.block.d(),o.token=null,o=null,t[4](null)}}}const an="script";function sn(n,t,e){let{background:o="#fff"}=t;const c=window.__UNYW_PRIVATE_IP||"localhost";let r,i=tn().then((n=>n.unyw.info()));var l;return l=async()=>{const{process:n}=await tn();console.log(await n.screen({width:r.clientWidth,height:r.clientHeight})),console.log(r.clientWidth,r.clientHeight)},$().$$.on_mount.push(l),n.$$set=n=>{"background"in n&&e(0,o=n.background)},[o,r,c,i,function(n){k[n?"unshift":"push"]((()=>{r=n,e(1,r)}))}]}class dn extends M{constructor(n){super(),q(this,n,sn,ln,r,{background:0})}}function un(n,t,e){const o=n.slice();return o[5]=t[e],o}function fn(t){let e;return{c(){e=p("div"),e.innerHTML="<h1>Settings</h1> \n\t\t<p>Work in progress :)</p>",m(e,"class","page page-settings svelte-1hx54kp")},m(n,t){d(n,e,t)},p:n,i:n,o:n,d(n){n&&u(e)}}}function pn(t){let e,o,c,r,i,l,a,f,h,g;return h=new dn({}),{c(){e=p("div"),o=p("select"),c=p("option"),c.textContent="-- Please choose an option --",r=p("option"),r.textContent="Dog",i=p("option"),i.textContent="Cat",l=p("option"),l.textContent="Hamster",a=p("option"),a.textContent="Parrot",f=v(),W(h.$$.fragment),c.__value="",c.value=c.__value,r.__value="dog",r.value=r.__value,i.__value="cat",i.value=i.__value,l.__value="hamster",l.value=l.__value,a.__value="parrot",a.value=a.__value,m(e,"class","page page-logs svelte-1hx54kp")},m(n,t){d(n,e,t),s(e,o),s(o,c),s(o,r),s(o,i),s(o,l),s(o,a),s(e,f),D(h,e,null),g=!0},p:n,i(n){g||(I(h.$$.fragment,n),g=!0)},o(n){K(h.$$.fragment,n),g=!1},d(n){n&&u(e),H(h)}}}function hn(t){let e;return{c(){e=p("div"),e.innerHTML='<button class="svelte-1hx54kp">Edit repos <i class="zmdi zmdi-edit"></i></button> \n\t\t<button class="svelte-1hx54kp">Add keys <i class="zmdi zmdi-key"></i></button> \n\t\t<br/> \n\t\t<h3>https://unyw.github.io/repo-main/stable</h3><hr/>',m(e,"class","page page-add svelte-1hx54kp"),m(e,"id","addid")},m(n,t){d(n,e,t)},p:n,i:n,o:n,d(n){n&&u(e)}}}function vn(t){let e,o={ctx:t,current:null,token:null,hasCatch:!1,pending:$n,then:gn,catch:mn,value:1};return S(tn().then(kn).then(t[2]),o),{c(){e=p("div"),o.block.c(),m(e,"class","page page-apps svelte-1hx54kp")},m(n,t){d(n,e,t),o.block.m(e,o.anchor=null),o.mount=()=>e,o.anchor=null},p(n,e){V(o,t=n,e)},i:n,o:n,d(n){n&&u(e),o.block.d(),o.token=null,o=null}}}function mn(t){return{c:n,m:n,p:n,d:n}}function gn(n){let t,e=n[1],o=[];for(let t=0;t<e.length;t+=1)o[t]=bn(un(n,e,t));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();t=h("")},m(n,e){for(let t=0;t<o.length;t+=1)o[t].m(n,e);d(n,t,e)},p(n,c){if(0&c){let r;for(e=n[1],r=0;r<e.length;r+=1){const i=un(n,e,r);o[r]?o[r].p(i,c):(o[r]=bn(i),o[r].c(),o[r].m(t.parentNode,t))}for(;r<o.length;r+=1)o[r].d(1);o.length=e.length}},d(n){f(o,n),n&&u(t)}}}function bn(t){let e,o,c,r,l,a,f,g,b=t[5]+"";return{c(){var n,s;e=p("div"),o=p("img"),l=v(),a=p("p"),f=h(b),g=v(),n=o.src,s=c=`/apps/${t[5]}/icon.png`,i||(i=document.createElement("a")),i.href=s,n!==i.href&&m(o,"src",c),m(o,"alt",r=`Icon for ${t[5]}`),m(o,"height","40px"),m(o,"width","40px"),m(e,"class","app-container svelte-1hx54kp")},m(n,t){d(n,e,t),s(e,o),s(e,l),s(e,a),s(a,f),s(e,g)},p:n,d(n){n&&u(e)}}}function $n(t){return{c:n,m:n,p:n,d:n}}function yn(n){let t,e,o,c,r,i,l;const a=[vn,hn,pn,fn],f=[];function h(n,t){return"apps"===n[0]?0:"add"===n[0]?1:"logs"===n[0]?2:"settings"===n[0]?3:-1}function g(t){n[3](t)}~(e=h(n))&&(o=f[e]=a[e](n));let b={tabs:{apps:{icon:"zmdi zmdi-widgets",label:"Apps"},add:{icon:"zmdi zmdi-download",label:"Add app"},logs:{icon:"zmdi zmdi-memory",label:"Logs"},settings:{icon:"zmdi zmdi-settings",label:"Settings"}}};return void 0!==n[0]&&(b.active=n[0]),r=new J({props:b}),k.push((()=>function(n,t,e){const o=n.$$.props[t];void 0!==o&&(n.$$.bound[o]=e,e(n.$$.ctx[o]))}(r,"active",g))),{c(){t=p("main"),o&&o.c(),c=v(),W(r.$$.fragment),m(t,"class","svelte-1hx54kp")},m(n,o){d(n,t,o),~e&&f[e].m(t,null),s(t,c),D(r,t,null),l=!0},p(n,[l]){let s=e;e=h(n),e===s?~e&&f[e].p(n,l):(o&&(A(),K(f[s],1,1,(()=>{f[s]=null})),O()),~e?(o=f[e],o?o.p(n,l):(o=f[e]=a[e](n),o.c()),I(o,1),o.m(t,c)):o=null);const d={};var u;!i&&1&l&&(i=!0,d.active=n[0],u=()=>i=!1,_.push(u)),r.$set(d)},i(n){l||(I(o),I(r.$$.fragment,n),l=!0)},o(n){K(o),K(r.$$.fragment,n),l=!1},d(n){n&&u(t),~e&&f[e].d(),H(r)}}}const kn=({file:n})=>n.list({path:"/usr/share/unyw/apps"});function wn(n,t,e){let o="apps";return[o,{a:{icon:"favicon.png",label:"xterm"},b:{icon:"favicon.png",label:"firefox"},c:{icon:"favicon.png",label:"remote"},d:{icon:"favicon.png",label:"vscode"},e:{icon:"favicon.png",label:"gimp"},f:{icon:"favicon.png",label:"libreoffice"}},({list:n})=>Object.keys(n),function(n){o=n,e(0,o)}]}return new class extends M{constructor(n){super(),q(this,n,wn,yn,r,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
